name: CI/CD Pipeline

on:
  push:
    branches:
      -main

jobs:
 build-and-test:
   runs-on: ubuntu-latest
   steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2

    - name: Run tests
    env:
        DATABASE_URL: ${{secret.DATABASE.URL}}    
    run: npm test


deploy:
  runs-on: ubuntu-latest
  needs: build-and-test
  steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Log in to Docker Hub
    uses: docker/login-actions@v2
    with:
      username: ${{secret.DOCKER_USERNAME}}
      password: ${{secret.DOCKER_PASSWORD}}

  - name: Build and push Docker image
    uses: docker/build-push-actions@v3
    with:
      context: .
      push: true
      tags: your-docker-username/polling-app-backend:latest
    

